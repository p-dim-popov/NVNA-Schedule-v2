!function(e){function t(t){for(var n,o,s=t[0],r=t[1],i=0,l=[];i<s.length;i++)o=s[i],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&l.push(a[o][0]),a[o]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);for(c&&c(t);l.length;)l.shift()()}var n={},a={0:0};function o(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(e){var t=[],n=a[e];if(0!==n)if(n)t.push(n[2]);else{var s=new Promise((function(t,o){n=a[e]=[t,o]}));t.push(n[2]=s);var r,i=document.createElement("script");i.charset="utf-8",i.timeout=120,o.nc&&i.setAttribute("nonce",o.nc),i.src=function(e){return o.p+""+({}[e]||e)+".bundle.js"}(e);var c=new Error;r=function(t){i.onerror=i.onload=null,clearTimeout(l);var n=a[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),s=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",c.name="ChunkLoadError",c.type=o,c.request=s,n[1](c)}a[e]=void 0}};var l=setTimeout((function(){r({type:"timeout",target:i})}),12e4);i.onerror=i.onload=r,document.head.appendChild(i)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],r=s.push.bind(s);s.push=t,s=s.slice();for(var i=0;i<s.length;i++)t(s[i]);var c=r;o(o.s=0)}([function(e,t,n){!async function(){const e=await Promise.all([Promise.all([n.e(1),n.e(6)]).then(n.t.bind(null,1,7)),n.e(4).then(n.t.bind(null,2,7)),n.e(2).then(n.t.bind(null,3,7)),n.e(3).then(n.bind(null,4)),n.e(5).then(n.bind(null,5))]);window.s=e;const[{default:t},{default:a},o,{Lesson:s,LessonDay:r,LessonWeek:i,LessonWeeks:c},{Router:l}]=e,d="https://web--scrapper.herokuapp.com/webscrapper";fetch(`${d}?url=${encodeURIComponent("http://schedule.nvna.free.bg")}`);const u=[],m=document.getElementById("content"),[p,h,f]=await Promise.all([fetch("./templates/common/header.hbs"),fetch("./templates/common/footer.hbs"),fetch("./templates/errorNotification.hbs")]).then(async e=>await Promise.all(e.map(e=>e.text())));o.registerPartial("errorNotification",f);const y=o.compile(p),g=o.compile(h);function v(e){return async function(){m.innerHTML="",await b.call(this);const t=await e.call(this);await w.call(this),await k.call(this,t)}}async function b(){m.innerHTML+=y({})}async function w(){m.innerHTML+=g({})}async function k(e){a(document.getElementById("date"),{dateFormat:"Y-m-d",defaultDate:this.params.date?this.params.date.format("YYYY-MM-DD"):"today",altFormat:"D, d M Y",altInput:!0,disableMobile:!0}),document.getElementById("code").value=this.params.code||"",document.getElementById("searching-for").value=this.params.searchingFor||"group",document.getElementById("period").value=this.params.period||"day",this.params.weeksCount&&(document.getElementById("weeks-count").value=this.params.weeksCount,document.getElementById("weeks-count").hidden=!1),document.getElementById("submit-btn").addEventListener("click",()=>{const e={searchingFor:document.getElementById("searching-for"),code:document.getElementById("code"),period:document.getElementById("period"),date:document.getElementById("date"),weeksCount:document.getElementById("weeks-count")};if(!e.code.value)return void B("Няма въведен код");e.period.value||(e.period.value="day"),e.date.value||(e.date.value=t().format("YYYY-MM-DD"));let n="";switch(e.period.value){case"day":case"week":n=`#/${e.searchingFor.value}/${e.code.value}/${e.period.value}/${e.date.value}`;break;case"weeks":n=`#/${e.searchingFor.value}/${e.code.value}/${e.period.value}/${e.date.value}/${e.weeksCount.value}`}window.location.hash!==n&&(document.getElementById("submit-btn").disabled=!0,document.getElementById("submit-btn").value="Зарежда се..."),l.navigate(n)}),document.getElementById("period").addEventListener("change",e=>{e.target&&(document.getElementById("weeks-count").hidden="weeks"!==document.getElementById("period").value)}),document.getElementById("advanced-usage-btn").addEventListener("click",()=>l.navigate("#/advanced-usage")),e&&e.call(this)}async function E(){if(!this.params.code)return;this.params.date||(this.params.date=t().format("YYYY-MM-DD")),this.params.date=t(this.params.date,"YYYY-MM-DD");const e=`http://nvna.eu/schedule/?group=${this.params.code}&queryType=${this.params.searchingFor}&Week=${this.params.date.week()}`;let n=`${d}?url=${encodeURIComponent(e)}`;"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||(n="../testData.json");const a=await fetch(n).then(e=>e.json());this.params.period||(this.params.period="day");const o={};switch(u.length=0,this.params.period){case"day":o.lessonDay=s.getLessonWeek(a).days.find(e=>t(e.date,"YYYY-MM-DD").format()===this.params.date.format()),u.push(o.lessonDay);break;case"week":o.lessonWeek=s.getLessonWeek(a),o.lessonWeek.days.forEach(e=>u.push(e));break;case"weeks":this.params.weeksCount||(this.params.weeksCount=1);let e=[];for(let t=1;t<+this.params.weeksCount;t++){const n=`http://nvna.eu/schedule/?group=${this.params.code}&queryType=${this.params.searchingFor}&Week=${this.params.date.week()+t}`;e.push(fetch(`${d}?url=${encodeURIComponent(n)}`))}const n=[a,...await Promise.all(e).then(async e=>await Promise.all(e.map(e=>e.json())))];o.lessonWeeks=new c(...n.map(e=>s.getLessonWeek(e))),o.lessonWeeks.list.forEach(e=>e.days.forEach(e=>u.push(e)));break;default:return}this.task.done(o)}async function L(){const[e,t,n,a]=await Promise.all([fetch("./templates/lesson/lesson.hbs"),fetch("./templates/lesson/day.hbs"),fetch("./templates/lesson/week.hbs"),fetch("./templates/lesson/weeks.hbs")]).then(async e=>await Promise.all(e.map(e=>e.text())));if(o.registerPartial("lesson",e),o.registerPartial("day",t),o.registerPartial("week",n),o.registerPartial("weeks",a),this.event.previousResult.lessonDay){const e=o.compile(t);m.innerHTML+=e(this.event.previousResult.lessonDay)}else if(this.event.previousResult.lessonWeek){const e=o.compile(n);m.innerHTML+=e(this.event.previousResult.lessonWeek)}else if(this.event.previousResult.lessonWeeks){const e=o.compile(a);m.innerHTML+=e(this.event.previousResult.lessonWeeks)}const s=o.compile(await fetch("./templates/downloadBtn.hbs").then(e=>e.text()));return m.innerHTML+=s({}),async function(){[...document.querySelectorAll(".subject")].forEach(e=>e.addEventListener("click",e=>{if(!e.target)return;let t=e.target;"SMALL"!==e.target.tagName&&"H6"!==e.target.tagName||(t=e.target.parentNode),t.classList.contains("subject")&&[...t.children].pop().classList.toggle("d-none")})),document.getElementById("download-btn").addEventListener("click",()=>{const e=document.getElementById("date").value;let t=u.map(e=>e.serialize("tsv")).join("\n").trim(),n=prompt("Въведи име на файл",e);if(null===n)return;n=(n||e)+".tsv";let a=new Blob([t],{type:"data:application/octet-stream"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,n);else{let e=document.createElement("a"),t=URL.createObjectURL(a);e.href=t,e.download=n,document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}})}}function B(e){document.getElementById("error-info-box").classList.remove("d-none"),document.getElementById("error-info-box").textContent=e;const t=()=>document.getElementById("error-info-box").classList.add("d-none"),n=setTimeout(t,3e3);document.getElementById("error-info-box").addEventListener("click",(function e(){document.getElementById("error-info-box").removeEventListener("click",e),clearTimeout(n),t()}))}[{path:"#/",on:v(()=>{})},{path:"#/:searchingFor/:code",before:E,on:v(L)},{path:"#/:searchingFor/:code/:period",before:E,on:v(L)},{path:"#/:searchingFor/:code/:period/:date",before:E,on:v(L)},{path:"#/:searchingFor/:code/:period/:date/:weeksCount",before:E,on:v(L)},{path:"#/advanced-usage",on:async function(){m.innerHTML="";const e=window.location.href.split("#")[0]+"#/",t=await fetch("./templates/advancedUsageInstructions.hbs").then(e=>e.text()),n=o.compile(t);m.innerHTML+=n({location:e});const a={};[a.day,a.week]=[...document.getElementsByTagName("select")];const s={};[s.day,s.week]=[...document.querySelectorAll('input[id^="code-for-"]')];const r={};[r.day,r.week]=[...document.getElementsByTagName("button")],Object.entries(r).forEach(([t,n])=>{return n.addEventListener("click",(o=t,async t=>{if(!s[o].value)return void B("Няма въведен код!");const n=`${e}${a[o].value}/${s[o].value}/${o}`;try{await navigator.clipboard.writeText(n);const e=r[o].textContent;r[o].textContent="Копиран!",r[o].disabled=!0,setTimeout(()=>{r[o].textContent=e,r[o].disabled=!1},1e3)}catch(e){document.getElementById("fallback-copy-input-area-"+o).value=n,document.getElementById("fallback-copy-input-area-"+o).hidden=!1,document.getElementById("fallback-copy-input-area-"+o).select()}}));var o}),document.getElementById("back-btn").addEventListener("click",()=>window.location.href=e.split("#/")[0])}}].forEach(e=>l.add(e)),l.init()}()}]);